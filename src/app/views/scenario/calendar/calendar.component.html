<div class="wrapper wrapper-content">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <div class="btn-group btn-group-xs pull-right">
                      <button class="btn btn-default" (click)="purchaseMaterial()">
                        新增原料采购
                      </button>

                      <button class="btn btn-default" (click)="orderDemand()">
                        新增订单生产计划
                      </button>
                    </div>
                    
                    <h5>生产计划表</h5>

                    <div class="btn-group btn-group-xs m-l-sm">
                      <button class="btn btn-success" (click)="runOR()">
                        <i class="fa fa-lightbulb-o"></i>生产计划自动优化
                      </button>
                    </div>
                </div>
                <div class="ibox-content">
                  <div [ngSwitch]="view">
                    <mwl-calendar-month-view
                      *ngSwitchCase="'month'"
                      [viewDate]="viewDate"
                      [events]="events"
                      [refresh]="refresh"
                      [activeDayIsOpen]="activeDayIsOpen"
                      (dayClicked)="dayClicked($event.day)"
                      (eventClicked)="handleEvent('Clicked', $event.event)"
                      (eventTimesChanged)="eventTimesChanged($event)">
                    </mwl-calendar-month-view>
                  </div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

<div bsModal #purchaseMaterialModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog ">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title pull-left">原料采购</h4>
        <button type="button" class="close pull-right" (click)="purchaseMaterialModal.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #purchaseMaterialForm="ngForm" class="form-horizontal">
            <!-- <div *ngIf="!detailForm.form.valid" class="alert alert-danger">
                <p *ngIf="description.touched && description.errors?.required">
                  场景描述字段为必填字段
                </p>
            </div> -->

            <div class="form-group">
                <label class="col-sm-4 control-label">原材</label>
                <div class="col-sm-8">
                  <ng-select name="material" [(ngModel)]="materialPurchaseDetailItem.item" required
                      [options]="rawMaterialOptions">
                  </ng-select>
                </div>
            </div>

            
            <div class="form-group">
                <label class="col-sm-4 control-label">采购计划</label>
                <div class="col-sm-8">
                  <table *ngIf="dateRange"  class="table table-striped table-hover">
                    <tr>
                      <th>日期</th>
                      <th>数量</th>
                    </tr>
                    <tr *ngFor="let pp of materialPurchaseDetailItem.purchasePlans; let i = index; trackBy:trackByIndex">
                      <td>{{pp.date | date: "yyyy-MM-dd"}}</td>
                      <td><input type="number" class="form-control" min="0" name="amount_{{i}}" [(ngModel)]="pp.amount" required></td>
                    </tr>
                  </table>
                </div>
            </div>
            
        </form>
      </div>
      <div class="modal-footer">
        <button [disabled]="!purchaseMaterialForm.form.valid" type="submit" class="btn btn-sm btn-info" (click)="confirmPurchasePlan()">确定</button>
        <button class="btn btn-sm btn-default" (click)="purchaseMaterialModal.hide()">取消</button>
      </div>
    </div>
  </div>
</div>

<div bsModal #orderDemandModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog ">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title pull-left">订单生产计划</h4>
        <button type="button" class="close pull-right" (click)="orderDemandModal.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #orderDemandForm="ngForm" class="form-horizontal">
            <!-- <div *ngIf="!detailForm.form.valid" class="alert alert-danger">
                <p *ngIf="description.touched && description.errors?.required">
                  场景描述字段为必填字段
                </p>
            </div> -->

            <div class="form-group">
                <label class="col-sm-4 control-label">订单号</label>
                <div class="col-sm-8">
                  <ng-select name="order" [(ngModel)]="orderDemandDetailItem.item" required
                      [options]="orderOptions">
                  </ng-select>
                </div>
            </div>

            
            <div class="form-group">
                <label class="col-sm-4 control-label">采购计划</label>
                <div class="col-sm-8">
                  <table *ngIf="dateRange"  class="table table-striped table-hover">
                    <tr>
                      <th>日期</th>
                      <th>数量</th>
                    </tr>
                    <tr *ngFor="let pp of orderDemandDetailItem.orderDemands; let i = index; trackBy:trackByIndex">
                      <td>{{pp.date | date: "yyyy-MM-dd"}}</td>
                      <td><input type="number" class="form-control" min="0" name="oo_amount_{{i}}" [(ngModel)]="pp.amount" required></td>
                    </tr>
                  </table>
                </div>
            </div>
            
        </form>
      </div>
      <div class="modal-footer">
        <button [disabled]="!orderDemandForm.form.valid" type="submit" class="btn btn-sm btn-info" (click)="confirmOrderDemand()">确定</button>
        <button class="btn btn-sm btn-default" (click)="orderDemandModal.hide()">取消</button>
      </div>
    </div>
  </div>
</div>